metadata:
  labels:
    nuclio.io/project-name: default
  name: csv2hive
spec:
  httpPort: 0
  imageHash: "1576563447422077700"
  publish: false
  loggerSinks:
    - level: debug
  timeoutSeconds: 0
  disable: false
  alias: latest
  handler: "main:handler"
  platform: {}
  env:
    - type: value
      name: CONTAINER_NAME
      value: bigdata
    - type: value
      name: IGZ_USER
      value: iguazio
    - type: value
      name: IGZ_PASS
      value: datal@ke!
    - type: value
      name: CSV_TO_HIVE_KV
      value: csv_to_hive_catalog
    - type: value
      name: NGINX_HOST
      value: v3io-webapi.default-tenant.svc
    - type: value
      name: NGINX_PORT
      value: "8081"
  runtime: "python:3.6"
  resources: {}
  build:
    commands:
      - 'pip install requests'
    functionSourceCode: aW1wb3J0IHJlcXVlc3RzDQppbXBvcnQgb3MNCmltcG9ydCBqc29uDQppbXBvcnQgY29sbGVjdGlvbnMNCmltcG9ydCB0aW1lDQpmcm9tIHJlcXVlc3RzLmF1dGggaW1wb3J0IEhUVFBCYXNpY0F1dGgNCg0KQ09OVEFJTkVSX05BTUUgPSBvcy5lbnZpcm9uLmdldCgnQ09OVEFJTkVSX05BTUUnLCAiYmlnZGF0YSIpDQpJR1pfUEFTUyA9IG9zLmVudmlyb24uZ2V0KCdJR1pfUEFTUycsICJkYXRhbEBrZSEiKQ0KSUdaX1VTRVIgPSBvcy5lbnZpcm9uLmdldCgnSUdaX1VTRVInLCAiaWd1YXppbyIpDQpDU1ZfVE9fSElWRV9LViA9IG9zLmVudmlyb24uZ2V0KCdDU1ZfVE9fSElWRV9LVicsICJjc3ZfdG9faGl2ZSIpDQpOR0lOWF9IT1NUID0gb3MuZW52aXJvbi5nZXQoJ05HSU5YX0hPU1QnLCAndjNpby13ZWJhcGkuZGVmYXVsdC10ZW5hbnQuc3ZjJykNCk5HSU5YX1BPUlQgPSBvcy5lbnZpcm9uLmdldCgnTkdJTlhfUE9SVCcsICc4MDgxJykNCg0KDQpkZWYgZ2V0X2t2X3VybChrdl9uYW1lKToNCiAgICByZXR1cm4gJ2h0dHA6Ly97MH06ezF9L3syfS97M30vJy5mb3JtYXQoTkdJTlhfSE9TVCwgTkdJTlhfUE9SVCwgQ09OVEFJTkVSX05BTUUsIGt2X25hbWUpDQoNCg0KZGVmIGdldF9mdW5jdGlvbl9oZWFkZXJzKHYzaW9fZnVuY3Rpb24pOg0KICAgIHJldHVybiB7DQogICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywNCiAgICAnQ2FjaGUtQ29udHJvbCc6ICduby1jYWNoZScsDQogICAgJ1gtdjNpby1mdW5jdGlvbic6IHYzaW9fZnVuY3Rpb24NCiAgICB9DQoNCg0KZGVmIHB1dF9jc3ZfcGF0aCgpOg0KICAgICAgICBkaWN0aW9uYXJ5ID0gIntcclxuXCJBdHRyaWJ1dGVzVG9HZXRcIjogXCIqXCIsXHJcblwiRmlsdGVyRXhwcmVzc2lvblwiOiBcInN0YXR1cz09J25ldydcIlxyXG59Ig0KICAgICAgICBqc29uX2RpY3QgPSBqc29uLmR1bXBzKGRpY3Rpb25hcnksIGluZGVudD00KQ0KICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoZ2V0X2t2X3VybChDU1ZfVE9fSElWRV9LViksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoPShJR1pfVVNFUiwgSUdaX1BBU1MpLCBkYXRhPWpzb25fZGljdCwgaGVhZGVycz1nZXRfZnVuY3Rpb25faGVhZGVycygnR2V0SXRlbXMnKSkNCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOg0KICAgICAgICAgICAgcGF0aHMgPSBqc29uLmxvYWRzKHJlc3BvbnNlLmNvbnRlbnQpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwYXRocyA9IFtdDQogICAgICAgIHJldHVybiBwYXRocw0KDQoNCmRlZiBnZXRfc3RydWN0dXJlZF9tZXNzYWdlKGNzdl9sb2NhdGlvbik6DQogICAgZXBvY2hfdGltZSA9IHRpbWUudGltZSgpDQogICAga2V5X2ZpZWxkID0gY3N2X2xvY2F0aW9uLnJlcGxhY2UoJy8nLCAnXycpKyJfIitzdHIoZXBvY2hfdGltZSkNCiAgICBqc29uX2RpY3QgPSBjb2xsZWN0aW9ucy5PcmRlcmVkRGljdChbDQogICAgICAgICgnS2V5JywgY29sbGVjdGlvbnMuT3JkZXJlZERpY3QoWygnaWQnLCB7J1MnOiBrZXlfZmllbGR9KV0pKSwNCiAgICAgICAgKCdJdGVtJywgY29sbGVjdGlvbnMuT3JkZXJlZERpY3QoWw0KICAgICAgICAgICgnbG9jYXRpb24nLCB7J1MnOiBjc3ZfbG9jYXRpb259KSwNCiAgICAgICAgICAoJ3N0YXR1cycsIHsnUyc6ICJuZXcifSksDQogICAgICAgICAgKCd0YWJsZV9uYW1lJywgeydTJzogIiJ9KQ0KICAgICAgICBdKSkNCiAgICAgIF0pDQogICAgcmV0dXJuIGpzb25fZGljdA0KDQoNCmRlZiBpbmdlc3RfdG9fa3YoY3N2X2xvY2F0aW9uLCBjb250ZXh0KToNCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCdJbnNpZGUgaW5nZXN0aW9uIGZ1bmN0aW9uIC4uLi4nKQ0KICAgIHBheWxvYWQgPSBqc29uLmR1bXBzKGdldF9zdHJ1Y3R1cmVkX21lc3NhZ2UoY3N2X2xvY2F0aW9uKSwgaW5kZW50PTQpDQogICAgdXJsID0gZ2V0X2t2X3VybChDU1ZfVE9fSElWRV9LVikNCiAgICBoZWFkZXJzID0gZ2V0X2Z1bmN0aW9uX2hlYWRlcnMoJ1B1dEl0ZW0nKQ0KICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGF1dGg9SFRUUEJhc2ljQXV0aChJR1pfVVNFUiwgSUdaX1BBU1MpLCBkYXRhPXBheWxvYWQsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD01KQ0KICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlICE9IDIwMDoNCiAgICAgICAgY29udGV4dC5sb2dnZXIuZXJyb3IoDQogICAgICAgICAgICAiaW5nZXN0aW9uIGZhaWxlZCB3aXRoIHN0YXR1cyBjb2RlICVzIGZvciByZWNvcmQgJXMiLCByZXNwb25zZS5zdGF0dXNfY29kZSwgcmVzcG9uc2UucmVxdWVzdC5ib2R5DQogICAgICAgICkNCg0KDQpkZWYgaGFuZGxlcihjb250ZXh0LCBldmVudCk6DQogICAgdHJ5Og0KICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCdJbnNpZGUgY3N2IHRvIGhpdmUgZnVuY3Rpb24gaGFuZGxlciAuLi4uJykNCiAgICAgICAgY3N2X3BhdGggPSBldmVudC5ib2R5LmRlY29kZSgndXRmLTgnKQ0KICAgICAgICBpZiBjc3ZfcGF0aC5zdHJpcCgpOg0KICAgICAgICAgICAgaW5nZXN0X3RvX2t2KGNzdl9wYXRoLCBjb250ZXh0KQ0KICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuUmVzcG9uc2UoYm9keT0nY3N2LXRvLWhpdmUgZW50cnkgcmVnaXN0ZXJlZCBzdWNjZXNzZnVsJywgaGVhZGVycz17fSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZT0ndGV4dC9wbGFpbicsIHN0YXR1c19jb2RlPTIwMCkNCiAgICAgICAgcmV0dXJuIGNvbnRleHQuUmVzcG9uc2UoYm9keT0nY3N2LXRvLWhpdmUgZW50cnkgZmFpbGVkIGFzIHBhdGggaXMgbWlzc2luZycsIGhlYWRlcnM9e30sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZT0ndGV4dC9wbGFpbicsIHN0YXR1c19jb2RlPTMwMCkNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGNvbnRleHQubG9nZ2VyLmVycm9yKCdjc3YgcGF0aCBpbmdlc3Rpb24gam9iIGZhaWxlZCcsIGUpDQogICAgICAgIHJldHVybiBjb250ZXh0LlJlc3BvbnNlKGJvZHk9J2Vycm9yIG9jY3VyIHdoaWxlIHdyaXRpbmcgdG8ga3YnLCBoZWFkZXJzPXt9LCBjb250ZW50X3R5cGU9J3RleHQvcGxhaW4nLCBzdGF0dXNfY29kZT01MDApDQo=
    timestamp: 1576563453
    runtimeAttributes:
      repositories: []
    noCleanup: false
    noCache: false
    offline: true
    codeEntryType: sourceCode
